pipeline {
    agent any {
            dockerfile {
                args "-v maven-repository:/home/docker/.m2"
            }
    }
    stages {
        stage ("The connect verification") {
           steps {
              echo "I find Jenkinsfile"
           }
        }
        stage ("Build Docker"){
            steps {
              sh 'docker-compose up -d'
            }
        }
        stage ('Run Test') {
            steps {
                sh '''
                 sh "${env.M2_HOME}/bin/mvn ${env.MVN_GOAL}"
                '''
            }
        }

    }
      post {
            always {
            allure([
             includeProperties: false,
             jdk: '',
             properties: [],
             reportBuildPolicy: 'ALWAYS',
             results: [[path: 'target/allure-results']]
            ])
             sh 'docker-compose down'
             echo 'Finished'
            }
      }

}
